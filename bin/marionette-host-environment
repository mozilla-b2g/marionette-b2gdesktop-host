#! /usr/bin/env node
var debug = require('debug')('marionette-host-environment:cli'),
    program = require('commander'),
    spawn = require('../index').spawn;

program
  .version(require('../package.json').version)
  .usage('[option] <target>')
  .option('-p, --product [type]', 'runtime to use (like firefox or b2g)', 'b2g')
  .option('--product-version [branch]', 'a specific release branch');

program.on('--help', function() {
  console.log('  Examples:');
  console.log('');
  console.log('     $ marionette-host-environment /path/where/i/store/binary');
  console.log('');
});

program.parse(process.argv);

if (['b2g', 'firefox'].indexOf(program.product) === -1) {
  console.error('--product must be either b2g or firefox');
  process.exit(1);
}

if (!program.args[0]) {
  console.error('a target where binary should live must be passed');
  process.exit(1);
}

var spawnConfig = { product: program.product };
var target = program.args[0];

if (program.productVersion)
  spawnConfig.version = program.productVersion;

console.log('--*-*- downloading %s to %s ------', spawnConfig.product, target);
spawn(target, spawnConfig, function(err, port, child) {
  console.log('-*-*- download complete for %s -----', spawnConfig.product);
  child.kill();
});
